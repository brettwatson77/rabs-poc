# Loom Failure Scenarios Reference Guide

This document catalogues everything that can go wrong in the Loom perpetual-calendar scheduling engine, how the system recognises the fault, and recommended operator responses. It complements `MASTER-LOOM-GUIDE.md` and the live **System Log** in the Loom Control Centre.

---

## 1. Resource Shortage Scenarios
### Description  
Insufficient core resources (staff, vehicles, venues) to fulfil the roster generated by the daily roll.

### When / How it Occurs  
* Midnight roll creates more shifts than resources available.  
* Sudden cancellation (staff illness, broken vehicle) drops supply below demand.

### Impact  
* Unassigned shifts (cards) → red highlight in UI.  
* Participants may be left without support or transport.

### Detection (Logger)  
`CATEGORY: RESOURCE` `SEVERITY: ERROR`  
The roller compares **required vs. available** counts and calls `logResourceShortage`.

### Resolution Suggestions  
* Pull casual staff, hire agency, rent vehicles.  
* Re-optimise or consolidate programs.  
* Temporarily reduce participant numbers.

### Example Log  
``STAFF SHORTAGE: Need 55, have 52 (shortage of 3)``  

---

## 2. Geographic / Distance Constraints
### Description  
Transport runs cannot be built inside the **Optimal Bus Run Duration** window.

### When / How it Occurs  
* Programs far from depot (e.g. Blue Mountains).  
* Too many pickups widely dispersed.

### Impact  
* Late arrivals / departures.  
* Program overlap; staff overtime.

### Detection  
`CATEGORY: OPTIMIZATION` with `optimizationType: BUS_RUN_DURATION`.

### Resolution Suggestions  
* Adjust program start/end.  
* Split runs or add vehicles.  
* Re-group participants by geography.

### Example Log  
``Bus run to Blue Mountains exceeds target duration by 45 minutes (target: 60, actual: 105)``  

---

## 3. Supervision Multiplier Conflicts
### Description  
Combined supervision load > staffing rule even though head-count seems OK.

### When / How it Occurs  
* Multiple high-support participants (1.5×, 2×) booked together.  
* Extra load detected after late changes.

### Impact  
* Under-staffed program, safety risk.

### Detection  
`CATEGORY: CONSTRAINT` `constraintType: SUPERVISION_RATIO` via `logSupervisionMultiplierConflict`.

### Resolution Suggestions  
* Add support workers.  
* Re-allocate high-support participants across groups.  
* Verify multiplier accuracy.

### Example Log  
``Supervision multiplier conflict: 3 participants require 4.25 supervision units``  

---

## 4. Vehicle / Transport Issues
### Description  
Vehicle unavailable, capacity/wheelchair mismatch, registration expired.

### When / How it Occurs  
* Maintenance down-time overlaps schedule.  
* Wheelchair participant assigned to non-accessible bus.  
* Vehicle at capacity buffer.

### Impact  
* Pickup/drop-off failures; missed activities.

### Detection  
`CATEGORY: RESOURCE` or `CONSTRAINT` with `constraintType: VEHICLE_CAPACITY`.

### Resolution Suggestions  
* Swap to accessible vehicle, rent van.  
* Split route.  
* Update maintenance calendar.

### Example Log  
``VEHICLE SHORTAGE: Need 8 wheelchair seats, only 6 available``  

---

## 5. Venue / Capacity Problems
### Description  
Venue booked beyond capacity or double-booked.

### When / How it Occurs  
* Extra participants added after venue was allocated.  
* Parallel programs assigned the same room.

### Impact  
* Breach of safety regulations, participant discomfort.

### Detection  
`CATEGORY: CONSTRAINT` `constraintType: VENUE_CAPACITY`.

### Resolution Suggestions  
* Source larger venue or split session.  
* Adjust attendee list.  
* Confirm venue booking system.

### Example Log  
``Venue capacity exceeded: Community Hall (max 20) requires 27 seats``  

---

## 6. Staff Qualification / Certification Issues
### Description  
Assigned staff lack mandatory qualifications (medication admin, hoist, etc.).

### When / How it Occurs  
* Roller picks staff based on availability not certs.  
* Expired certification flagged by nightly audit.

### Impact  
* Compliance breach, service risk.

### Detection  
`CATEGORY: CONSTRAINT` `constraintType: QUALIFICATION`.

### Resolution Suggestions  
* Swap in qualified staff.  
* Fast-track training.  
* Update staff records.

### Example Log  
``Qualification mismatch: No staff with Medication Endorsement for 'Hydrotherapy' program``  

---

## 7. Financial / Billing Problems
### Description  
NDIS funding or internal budget issues.

### When / How it Occurs  
* Participant plan limit reached.  
* Billing code not in participant plan.  
* Program cost drives profit below target margin.

### Impact  
* Unbillable services; financial loss.

### Detection  
`CATEGORY: FINANCIAL` (`issueType: FUNDING_EXHAUSTED`, `BILLING_CODE_MISMATCH`, etc.)

### Resolution Suggestions  
* Contact Support Coordinator.  
* Use alternative service or code.  
* Adjust staffing to reduce cost.

### Example Log  
``Funding exhausted: Participant p-123 has $0 remaining in community participation budget``  

---

## 8. Time / Scheduling Conflicts
### Description  
Overlap between programs, transport, or staff shifts.

### When / How it Occurs  
* Long bus run pushes start time past program start.  
* Staff assigned to two programs simultaneously.

### Impact  
* Late arrivals, overtime penalties, participant dissatisfaction.

### Detection  
`CATEGORY: CONSTRAINT` `constraintType: TIME_CONFLICT`.

### Resolution Suggestions  
* Shift program times.  
* Add buffer in configuration.  
* Re-optimise routing.

### Example Log  
``Time conflict: Staff s-456 assigned 09:00-12:00 & 10:30-13:30``  

---

## 9. Weather / Environmental Issues
### Description  
External factors make activities unsafe or impossible.

### When / How it Occurs  
* Severe weather for outdoor programs.  
* Heatwave triggers policy thresholds.

### Impact  
* Program cancellations, transport delays.

### Detection  
`CATEGORY: OPERATIONAL` `alertType: WEATHER`, severity `WARN` or `CRITICAL`.

### Resolution Suggestions  
* Switch to indoor alternative.  
* Reschedule or cancel with notice.  
* Notify families.

### Example Log  
``Weather alert: Extreme heat forecast > 38 °C for Outdoor Sports – consider indoor venue``  

---

## 10. System / Technical Failures
### Description  
Infrastructure or software errors.

### When / How it Occurs  
* DB outage, network loss, cron job crash.  
* Unexpected exceptions in logic engine.

### Impact  
* Loom roll fails; stale schedule; data loss.

### Detection  
`CATEGORY: SYSTEM` with `errorType: DATABASE`, `PROCESSING`, `CONFIGURATION`.

### Resolution Suggestions  
* Restart services, restore backup.  
* Check server health.  
* Patch bug and re-run roll.

### Example Log  
``Database connection error during loom roll – timeout after 30000 ms``  

---

## 11. Data Integrity Issues
### Description  
Missing, corrupt, or duplicate data.

### When / How it Occurs  
* Participant without address.  
* Duplicate staff record.  
* Invalid UUID in foreign key.

### Impact  
* Logic engine aborts, incorrect allocations.

### Detection  
`CATEGORY: SYSTEM` `errorType: DATA_INTEGRITY` raised by validation layer.

### Resolution Suggestions  
* Run integrity checker.  
* Fix record in admin UI / SQL.  
* Strengthen validation rules.

### Example Log  
``Data integrity error: participant_id null in tgl_loom_participant_allocations``  

---

## 12. Emergency Situations
### Description  
Unplanned critical events (medical emergency, evacuation, vehicle accident).

### When / How it Occurs  
* Real-time alert from staff mobile app.  
* External authority notice.

### Impact  
* Immediate program disruption, safety risk.

### Detection  
`CATEGORY: OPERATIONAL` `alertType: EMERGENCY` severity `CRITICAL`.

### Resolution Suggestions  
* Follow emergency protocols.  
* Contact emergency services.  
* Document actions in system log.

### Example Log  
``EMERGENCY: Vehicle accident on Route 3 – 000 called, 2 staff + 6 participants involved``  

---

## Using This Guide

1. **Monitor** the live System Log for new ERRORS, WARNINGS and CRITICAL alerts.  
2. **Filter** by severity/category to focus on actionable issues.  
3. **Consult** the corresponding scenario section above for resolution playbooks.  
4. **Record** outcome actions to keep the audit trail complete.

The Loom engine will keep running, highlighting any red or orange areas that need human expertise. Use this guide as your quick-reference handbook whenever something turns **red**.  
